# Add the vendored libraries to the path

import markdown from "./foo.md";

import sys
from pathlib import Path

sys.path.append(str(Path(__file__).parent / "vendor"))

import jinja2
from fastapi import FastAPI, Request
from pydantic import BaseModel

environment = jinja2.Environment()
template = environment.from_string("Hello, {{ name }}!")

async def on_fetch(request, env):
    import asgi
    return await asgi.fetch(app, request, env)

app = FastAPI()

@app.get("/")
async def root():
    message = "This is an example of FastAPI with Jinja2 - go to /hi/<name> to see a template rendered"
    return {"message": message}


@app.get("/hi/{name}")
async def say_hi(name: str):
    message = template.render(name=name)
    return {"message": message}


@app.get("/env")
async def env(req: Request):
    env = req.scope["env"]
    return {
        "message": "Here is an example of getting an environment variable: "
        + env.MESSAGE
    }
